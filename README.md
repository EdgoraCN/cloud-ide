# Cloud IDE [中文](README_CN.md) 

A complete and easy-to-use cloud development environment for developers

## Quick Start

### Use default configuration and disable security

```bash
docker run --name cloud-ide   \
-p 8443:8443  \
-e IDE_ALLOW_HTTP=true \
-e IDE_NO_AUTH=true \
aimacity/cloud-ide
```

### Environmen varibles  and default value list

```bash
# code-server directory
 IDE_USER_DATA_DIR="$HOME/.local/share/code-server"
 # workspace directory
IDE_WORKSPACE="$HOME/workspace"
 # code-server extensions directory
IDE_EXTENSIONS_DIR="$HOME/.local/share/code-server/extensions"
 # allow http acess
IDE_ALLOW_HTTP=false
 # allow  anonymous access
IDE_NO_AUTH=false
```

### A full configurable example

```bash
docker run  -d  \
--name cloud-ide  \
--restart always \
-p 8443:8443  \
-e IDE_ALLOW_HTTP=true \
-e IDE_NO_AUTH=true \
-e IDE_EXTENSIONS_DIR=/extensions \
-e TZ="Asia/Shanghai"  \
-v ~/workspace/ermscloud:/home/aima/workspace   \
-v ~/vwcode-data-dir:/home/aima/.local/share/code-server \
-v ~/extensions:/extensions \
aimacity/cloud-ide

```

## VS Code Configuration

### Default Setting

* Default extensions installed [config/extensions.list](config/extensions.list)
* Default locale settting `zh-cn` [config/locale.json](config/locale.json)
* Default maven setting [config/setting.xml](config/setting.xml)

### Use gist files which generated by Settings Sync

```bash
# Create a file contains your `username/gist` under `$IDE_WORKSPACE/.vscode/sync.gist
echo "novboy/45e990947d88fe1d1fa1bdbda94481cd" >> $IDE_WORKSPACE/.vscode/sync.gist
# load all settings from glist 
install-ext
# Resart ide form terminal with command `restart-ide`
restart-ide
```

### Use extensions.list to install VS Code extensions

```bash
# Create a file contains your extensions ids  in file `$IDE_WORKSPACE/.vscode/extensions.list `
cat > $IDE_WORKSPACE/.vscode/extensions.list <<'EOF'
felipecaputo.git-project-manager
donjayamanne.githistory
EOF
# install extensions 
install-ext
# or  install extensions with args
install-ext felipecaputo.git-project-manager donjayamanne.githistory
# Resart ide form terminal with command `restart-ide`
restart-ide
```

## Workspace Configuration

### Execute workspace init scripts  before IDE start

* The default init script location is  `$IDE_WORKSPACE/.vscode/init.sh`

```bash
#!//usr/local/bin/dumb-init /bin/sh

# proxy seting
#export http_proxy=socks5h://127.0.0.1:1080
#export https_proxy=socks5h://127.0.0.1:1080

# ssh setting


# git setting
git config --global credential.helper store
#git config --global http.proxy socks5h://127.0.0.1:1080
#git config --global https.proxy socks5h://127.0.0.1:1080
#git config --global user.name "user"
#git config --global user.email "user@aima.city"

#  yarn and npm setting
yarn config set registry https://registry.npm.taobao.org
yarn config set disturl https://npm.taobao.org/dist 
npm config set registry https://registry.npm.taobao.org
npm config set disturl https://npm.taobao.org/dist

# maven setting
mkdir -p  ~/.m2
if [ -f  "$IDE_WORKSPACE/.vscode/settings.xml" ];then
    cp $IDE_WORKSPACE/.vscode/settings.xml ~/.m2
fi
```

### Supervisord service mangement

* Custom supervisord config file end  with `.conf` under  folder `$IDE_WORKSPACE/.vscode/service` will be loaded when supervisord started.

* A example to setup a statble ssh tunnels

```ini
[program:socks5AndDatabase]
command=/usr/bin/autossh  -M 31221   -i   %(ENV_IDE_WORKSPACE)s/.vscode/code.key  -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null  -o ServerAliveInterval=60  -o ServerAliveCountMax=3  -N  -L 5433:192.168.1.100:5433   -D  5555    user@aima.city
process_name=socks5AndDatabase
#numprocs=1
autostart=true
autorestart=true
startretries=999
redirect_stderr=true
```

* Reload service

```bash
supervisorctl reread
supervisorctl  update
```

### Dev Tools Included out of the box

toolings pre-installed and ready to use.

```html
- Comes with
  - Java
  - php
  - Golang
  - C++
  - Nodejs
  - Python
  - Rust
  - Ruby
```

### Setting and Workspace synchronization

#### OneDrive VSCode settting and workspace synchronization

* start a fresh workspace and start synchronization

```bash
#  start a new instance
docker run --name ide-beta   \
-p 9888:8443  \
-e IDE_ALLOW_HTTP=true \
-e IDE_NO_AUTH=true \
aimacity/cloud-ide
```

```bash
#  Modify $IDE_WORKSPACE/.vscode/ondrive/config
# Directory where the files will be synced
sync_dir = "~/OneDrive"
# Skip files and directories that match this pattern
skip_file = "~*|.~*|*.tmp|*.log"
skip_dir = "node_modules|.m2|extensions|target"
# give  a folder name to  the workspace in onedrive, if not set, `default` will be used
workspace_name=default 
```

```bash
#  if you have token then create $IDE_WORKSPACE/.vscode/ondrive/refresh_token
cat > $IDE_WORKSPACE/.vscode/ondrive/refresh_token <<'EOF'
the token data...
EOF

# if you done have a token, execute the fllowing command to create a new one
get-onedrive-token
# a new file $IDE_WORKSPACE/.vscode/ondrive/refresh_token was created
```

```bash
# modify $IDE_WORKSPACE/.vscode/service/onedirve.conf to enable autostart
[program:onedrive]
command=/usr/bin/onedrive.sh
process_name=onedrive
#numprocs=1
#enable autostart
autostart=true
autorestart=true
startretries=999
redirect_stderr=true
```

```bash
# everything is ok now , let's create the new workspace and restart all services
workspace new
# refresh browser
```

* load an exist workspace form local onedrive cache and start synchronization

```bash
# everything is ok now , let's create the new workspace and restart all services
workspace use [workspace folder name]
# refresh browser
```

* load an exist workspace  without local cache and start synchronization

```bash
export  sync_dir=~/OneDrive
export  workspace_name=default
mkdir -p  $sync_dir/${workspace_name}/User
mkdir -p $sync_dir/${workspace_name}/workspace/.vscode/onedirve
# download cloud-ide/${workspace_name}/.vscode/onedirve/{config,sync_list,refresh_token} from cloud  
# then put them under $sync_dir/${workspace_name}/workspace/.vscode/onedirve
workspace use $workspace_name
# refresh browser
```

* disable onedrive and restore workspace

```bash
workspace leave
# refresh browser
```

* show local cached workspace

```bash
workspace ls
```

#### Mega VSCode settting and workspace synchronization (future)

#### Sync settting and workspace wtih [Syncthing](https://github.com/syncthing/syncthing)  (future)

## Features

* Workspace and VS Code Setting synchronization

* Workspace service, toolchain management (in process)

* VS Code language pack support  (chinese is tested)

* Network setting（plan）

## License

Credit goes to [code-server](https://github.com/aimacity/code-server) project.  
Code for this configuration is licensed under Apache 2.0, detailed in [LICENSE.md](LICENSE.md)